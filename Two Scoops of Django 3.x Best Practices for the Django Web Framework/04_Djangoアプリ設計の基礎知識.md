# Two Scoops of Django 3.x

## 4. Djangoアプリ設計の基礎知識
- Django開発の初心者は、Djangoにおける「アプリ」という用語の理解に苦しむことがよくある。
  - そこで、Djangoアプリの設計に入る前にいくつかの定義を確認する。
- **Djangoプロジェクト**とは、 Djangoのフレームワークを使ったWebアプリケーションのことである。
- **Djangoアプリ**とは、プロジェクトの一機能として設計されたライブラリのことである。
- Djangoプロジェクトは、複数のDjangoアプリで構成されている。
- Djangoアプリの中には、プロジェクトの内部にあって再利用されないものもあれば、サードパーティのDjangoパッケージもある。
- **INSTALLED_APPS**とは、Djangoプロジェクトが利用することのできるDjangoアプリの一覧のことである。
- **サードパーティのDjangoパッケージ**とは、パッケージ化された、プラグインとして利用可能 (再利用可能)なDjangoアプリのことである。

### 4.1 Djangoアプリ設計の黄金律
> "優れたDjangoアプリを開発し、維持していく秘訣は、Douglas McIlroyによる次のUnix哲学に従うことだ。「一つのことをするプログラムを書き、それをうまくやる」"
> ーJames Bennett (Django のコア開発者)

- それぞれのアプリは自分自身のタスクに集中しなければならない。
  - アプリについて、(適切な長さの)一文で説明できない場合や、説明の過程で「and (そして…)」を何度も言わなければならない場合は、アプリが大きすぎて分割すべきだと言える。

#### 4.1.1 アプリの実例
- 架空のアイスクリームショップ「Two Scoops」のWebアプリケーションを作っていると仮定する。
- 一例として、プロジェクト内のアプリは以下のようになる。
  - アイスクリームのフレーバーを記録し、ウェブサイトに掲載するフレーバーアプリ。
  - Two Scoopsの公式ブログ用のブログアプリ。
  - お店のイベント情報をウェブサイトに掲載するイベントアプリ。
- これらのアプリは、それぞれがひとつの役割を担っている。
- アプリ同士に関連性はあるものの、1つのアプリで全てをまかなうよりも、3つの機能に特化したアプリがある方が望ましいことがわかる。
- 将来的には、こんなアプリでサイトを拡張していくかもしれない。
  - アイスクリームの通信販売を行うためのショップアプリ。
  - アイスクリーム食べ放題のプレミアムイベントのチケットを販売するチケットアプリ。
    - イベントアプリとチケットアプリを分割していることに注目してほしい。
    - イベントアプリを拡張してチケットを販売するのではなく、チケットを必要としないイベントがほとんどであることや、イベントカレンダーやチケット販売は、サイトの成長に伴い複雑なロジックを含む可能性があることから、別のチケットアプリを作成した。

### 4.2 Djangoアプリの命名について
- 退屈でつまらなく、わかりやすい名前を使うことを推奨する。
- 具体的には、flavors (フレーバー/味)、animals (動物)、blog (ブログ)、polls (投票)、estimates (見積もり)、finances (財務) など…
  - 可能な限り一語であることが望ましい。
- 覚えやすい名前にすることで、プロジェクトのメンテナンスが容易になる。
- 「アプリの名前はアプリのメインモデルの複数形でなければならない」というのが一般的なルールとしてあるが、このルールには多くの例外がある。(blogはその代表例)
- 命名の際には、「URLをどのように表示させたいか」も考慮する必要がある。
  - サイトのブログが http://www.example.com/weblog/ に表示されるようにしたい場合は、メインモデルが Post であっても、アプリの名前を blog、posts、blogposts ではなく weblog とすることを検討すべき。
  - これにより、どのアプリがサイトのどの部分に対応しているかがわかりやすくなる。
- PEP 8のパッケージ名に準拠した命名を使用することを推奨する。
  - 数字、ダッシュ、ピリオド、スペース、特殊文字を含まない、短い、すべて小文字の名前。
  - 可読性を保つために必要であれば、アンダースコアを使って単語を区切ってもよい (が、推奨されない)。

### 4.3 迷ったらアプリを小さくする
- アプリのデザインを完璧にしようと考えすぎる必要はない。時にはアプリを作り直したり、分割し直したりしなければならないこともある。
- アプリは極力小さくしておくべき。
  - 巨大なアプリがいくつかあるより、小さなアプリがたくさんあるほうがいい。

### 4.4 アプリに含まれるモジュールについて
- このセクションでは、アプリに含まれるPythonモジュールについて、一般的な例と一般的でない例について解説する。

#### 4.4.1 一般的なアプリのモジュール
- 世のDjangoアプリの99%で見られる、一般的な例。
- スラッシュ (/) で終わるモジュールはPythonパッケージを表し、1つ以上のモジュールを含むことができる。

```
# Common modules
scoops/
├── __init__.py
├── admin.py
├── forms.py
├── management/
├── migrations/
├── models.py
├── templatetags/
├── tests/
├── urls.py
└── views.py
```

- アプリを構築する際、Djangoアプリにおけるモジュール名の慣習に従うことで、自分自身や他の人の振る舞いを規定し、コードの読解を容易にすることができる。
- PythonやDjangoは十分に柔軟性があるので、この慣例に違反する名前を付けることもできるが、そうした場合には問題が生じることになる。
  - 技術的な観点での問題がすぐに起こるわけではなく、しばらくしてから標準的でないモジュール名が不快な経験をもたらす原因となるだろう。

#### 4.4.2 一般的でないアプリのモジュール

```
# Common modules
scoops/
├── api/
├── behaviors.py
├── constants.py
├── context_processors.py
├── decorators.py
├── db/
├── exceptions.py
├── fields.py
├── factories.py
├── helpers.py
├── managers.py
├── middleware.py
├── schema.py
├── signals.py
├── utils.py
└── viewmixins.py
```

|ファイル・ディレクトリ名|目的|
|---|:--|
|api/|apiを作成する際に必要な様々なモジュールを配置する|
|behaviors.py|モデルミックスインを配置する。(6.7.1 参照)|
|constants.py|アプリ単位の設定値を配置する。設定値が多い場合はさらに分割するとプロジェクトの見通しを良くなる。|
|decorators.py|デコレーターを配置する。(9.3 参照)|
|db/|カスタムモデルのフィールドやコンポーネントを配置する。|
|fields.py|一般的にフォームフィールドに使用される。db/パッケージを作成するほどのフィールドがない場合、モデルに使用されることもある。|
|factories.py|テストデータのファクトリを配置する。(24.3.5 参照)|
|helpers.py|ヘルパー関数を配置する。ViewやModelは肥大化する傾向にあるので、それらから切り出して軽量化する。utils.pyと命名する場合もある。|
|managers.py|(Modelが大きくなりすぎた場合)カスタムモデルマネージャーをこのモジュールに配置する。|
|schema.py|GraphQL APIのビハインドコードを配置する。|
|signals.py|カスタムシグナルを配置する。(非推奨)|
|utils.py|helpers.pyと同義。|
|viewmixins.py|View Mixinを配置する。(Viewを軽量化できる)|

- 上記のモジュールはすべて「アプリレベル」にフォーカスしたものである。
